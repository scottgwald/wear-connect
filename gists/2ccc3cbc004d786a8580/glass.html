<html style="width:100%; height:100%; overflow:hidden">
<head>
<!-- You can include external scripts here like so... -->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.0/zepto.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>-->
    <!-- use Glass font -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="http://unslider.com/unslider.min.js"></script>
    <!-- add fit text js to fit text to screen -->
    <link rel="stylesheet" type="text/css" href="https://raw.githubusercontent.com/shrig94/UROP/master/glass.css" />
    <link rel="stylesheet" type="text/css" href="https://raw.githubusercontent.com/shrig94/UROP/master/animate.css" />
    <link rel="stylesheet" type="text/css" href="https://raw.githubusercontent.com/shrig94/UROP/master/language.css" />

    <script type="text/javascript">
        $.fn.exists = function () {
            return this.length !== 0;
        }
        
        $(document).on("ready", function(){
            var slide = $('.slide').unslider({
                delay: false,
                dots: false,
                complete: function() {
                    var cards = document.getElementById("cards");
                    var left = cards.style.left;
                    var index = parseInt(left.substr(left, left.length-1))/(-100);
                }
            });
            data = slide.data('unslider');
            timer = setInterval(data.next, 1000);
        });

    </script>
</head>
<body style="width:100%; height:100%; overflow:hidden; margin:0">

<script type="text/html" id="tpl_card1">
    <article class="photo">
        <img src="file:///storage/emulated/legacy/wearscript/gists/2ccc3cbc004d786a8580/pen1-BK.png" width="100%" height="100%">
        <div class="overlay-gradient-tall-dark" />
        <section>
            <p class="text-auto-size" style="visibility: visible; font-size: 100%; text-align: center">
                pen / pluma
            </p>
        </section>
    </article>
</script>

<slider class="slide">
        <ul id="cards">
            <li>
                <article>
                    <div class="layout-figure">
                        <div>
                            <img class="lang-img" src="file:///storage/emulated/legacy/wearscript/gists/2ccc3cbc004d786a8580/pen1-BK.png"></img>
                        </div>
                        <div>
                            <phrase class="text-normal">Pizza<span class="pri-lang">Pizza</span></phrase>
                            <phrase class="text-small">Me gusta el queso de pizza.<span class="pri-lang">I like cheese pizza.</span></phrase>
                        </div>
                    </div>
                </article>
            </li>
            <li>
                <article>
                    <div class="layout-figure">
                        <div>
                            <img class="lang-img" src="file:///storage/emulated/legacy/wearscript/gists/2ccc3cbc004d786a8580/pen1-BK.png"></img>
                        </div>
                        <div>

                            <phrase class="text-normal">Leche<span class="pri-lang">Milk</span></phrase>
                            <phrase class="text-small">Yo prefiero leche fria.<span class="pri-lang">I prefer cold milk.</span></phrase>

                        </div>
                    </div>
                </article>
            </li>
        </ul>
    </slider>

<script>

var customEndpoint = 'ws://192.168.2.230:8112/';
// var customEndpoint = 'ws://18.111.28.58:8112/';

function registered(channel, name) {
    WS.say("Registered as " + name);
}

Date.prototype.today = function () { 
    return ((this.getDate() < 10)?"0":"") + this.getDate() +"/"+(((this.getMonth()+1) < 10)?"0":"") + (this.getMonth()+1) +"/"+ this.getFullYear();
}
 
Date.prototype.timeNow = function () {
     return ((this.getHours() < 10)?"0":"") + this.getHours() +":"+ ((this.getMinutes() < 10)?"0":"") + this.getMinutes() +":"+ ((this.getSeconds() < 10)?"0":"") + this.getSeconds();
}

currentTimeString = function () {
    return new Date().today() + " @ " + new Date().timeNow();
}



function wordReceive(channel, word1, word2) {
    $('#cards').append(newCard(word2));
    clearInterval(timer);
    var slide = $('.slide').unslider({
                delay: false,
                dots: false,
                complete: function() {
                    var cards = document.getElementById("cards");
                    var left = cards.style.left;
                    var index = parseInt(left.substr(left, left.length-1))/(-100);
                }
            });
    data = slide.data('unslider');
    timer = setInterval(data.next, 1000);
}

function newCard(word) {
    return '<li>\
                <article>\
                    <div class="layout-figure">\
                        <div>\
                            <img class="lang-img" src="file:///storage/emulated/legacy/wearscript/gists/2ccc3cbc004d786a8580/pen1-BK.png"></img>\
                        </div>\
                        <div>\
\
                            <phrase class="text-normal">' + word + '<span class="pri-lang">Milk</span></phrase>\
                            <phrase class="text-small">Yo prefiero leche fria.<span class="pri-lang">I prefer cold milk.</span></phrase>\
\
                        </div>\
                    </div>\
                </article>\
            </li>';
}

function serverCustom() {
    WS.sound('SUCCESS');
    WS.subscribe('registered', registered)
    WS.subscribe(WS.groupDevice(), function(channel, a, b) {
        console.log('subscribed ' + channel);
    });
    WS.subscribe('words', wordReceive);
    WS.publish('register', 'registered', WS.groupDevice());
    WS.publish('words', 'water', 'agua');
    WS.publish('words', 'pen', 'pluma');
    WS.publish('words', 'pencil', 'lapiz');
    setTimeout(function() {
        WS.publish('words', 'hello', 'hola');
    }, 10000);
}

function registered(channel, name) {
    WS.say("Registered as " + name);
}

var playground = true;

function toggleServer() {
    WS.sound("SELECTED");
    if (!playground) {
        WS.serverConnect('{{WSUrl}}', server);
        playground = true;
    } else {
        WS.serverConnect(customEndpoint, serverCustom);
        playground = false;
    }
}

var cameraOn = false;
function toggleCamera() {
    if (cameraOn) {
        WS.cameraOff();
        WS.say('camera off');
        cameraOn = false;
    } else {
        WS.cameraOn(1, 1000, 1000);
        WS.say('camera on');
        cameraOn = true;
    }
}

function main() {
    if (WS.scriptVersion(1)) return;
    //ctx = document.getElementById('canvas').getContext("2d");
    // WS.serverConnect('{{WSUrl}}', server);
    toggleServer();
    toggleCamera();
    WS.dataLog(true, true, 0.15);
    //wordReceive('words', 'hello', 'hola');
}

window.onload = main;
</script>
</body>
</html>